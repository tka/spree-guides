<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>spree_guides: Customization Overview</title>

<link rel="stylesheet" type="text/css" href="stylesheets/style.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />
<link rel="stylesheet" type="text/css" href="stylesheets/overrides.style.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/overrides.print.css" media="print" />


<link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shCore.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shThemeRailsGuides.css" />


</head>
<body class="guide">
  <div id="topNav">
    <div class="wrapper">
      <strong>More at <a href="http://spreecommerce.com">spreecommerce.com:</a> </strong>
      <a href="http://spreecommerce.com/tour">Features</a> |
      <a href="http://spreecommerce.com/resources">Resources</a> |
      <a href="http://spreecommerce.com/blog">Blog</a> |
      <a href="http://spreecommerce.com/demo">Demo</a> |
      <a href="http://spreecommerce.com/community">Community</a> |
      <a href="http://spreecommerce.com/download">Download</a>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="overview.html" title="Return to home page">spree_guides</a></h1>
      <p class="hide"><a href="#mainCol">Skip navigation</a>.</p>
      <ul class="nav">
        <li><a href="overview.html">Home</a></li>
        <li class="index"><a href="index.html" onclick="guideMenu(); return false;" id="guidesMenu">Guides Index <span id="guidesArrow">&#9656;</span></a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
            <dl class="L">
    <dt>Start Here</dt>
      <dd><a href="getting_started.html">Getting Started with Spree</a></dd>
      <dd><a href="source_code.html">Working with the Source Code</a></dd>
      <dd><a href="server_configuration.html">Server Configuration</a></dd>
    <dt>Best Practices</dt>
      <dd><a href="developer_tips.html">Developer Tips</a></dd>
      <dd><a href="seo_considerations.html">SEO Considerations</a></dd>
    <dt>Basic Configuration</dt>
      <dd><a href="products_and_variants.html">Products and Variants</a></dd>
      <dd><a href="inventory.html">Inventory</a></dd>
      <dd><a href="taxonomy.html">Taxonomy/Categorization</a></dd>
      <dd><a href="payments.html">Payments</a></dd>
      <dd><a href="payment_gateways.html">Payment Gateways</a></dd>
      <dd><a href="zones.html">Zones</a></dd>
      <dd><a href="adjustments.html">Adjustments</a></dd>
      <dd><a href="taxation.html">Taxation</a></dd>
      <dd><a href="shipping.html">Shopping</a></dd>
      <dd><a href="promotions.html">Promotions</a></dd>
</dl>
<dl class="R">
    <dt>Digging Deeper</dt>
      <dd><a href="customization.html">Customization</a></dd>
      <dd><a href="extensions.html">Using Extensions</a></dd>
      <dd><a href="checkout.html">Spree Checkout Process</a></dd>
      <dd><a href="migration.html">Migrating Data to Spree</a></dd>
      <dd><a href="i18n.html">Internationalization/Localization</a></dd>
      <dd><a href="testing.html">Testing Spree Applications</a></dd>
      <dd><a href="security.html">Securing Spree Applications</a></dd>
      <dd><a href="preferences.html">Preferences</a></dd>
      <dd><a href="rest.html">REST API</a></dd>
      <dd><a href="scopes_and_groups.html">Product Groups and Scopes</a></dd>
      <dd><a href="searching.html">Seaching and Faceting</a></dd>
      <dd><a href="contributing_to_spree.html">Contributing to Spree</a></dd>
</dl>


          </div>
        </li>
        <li><a href="contributing_to_spree.html">Contribute</a></li>
        <li><a href="credits.html">Credits</a></li>
      </ul>
    </div>
  </div>

  <div id="feature">
    <div class="wrapper">
      <h2>Customization Overview</h2>
<p>This guide explains the customization and extension techniques you can use to adapt a generic Spree store to meet your specific design and functional requirements, including:</p>
<ul>
	<li>The type of customizations supported</li>
	<li>Changing views using both hooks and template replacements</li>
	<li>Adding and changing business logic</li>
	<li>Customizing controller action responses</li>
	<li>Configuring product image sizes</li>
</ul>
<p>For more detailed information and a step-by-step tutorial on creating extensions for Spree be sure to checkout the <a href="extensions.html">Extensions</a> guide.</p>


            <div id="subCol">
        <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
        <ol class="chapters">
          <li><a href="#types-of-customizations"><p>Types of Customizations</p>
</a><ul><li><a href="#site-specific"><p>Site Specific</p>
</a></li> <li><a href="#re-usable-extensions"><p>Re-usable Extensions</p>
</a></li> <li><a href="#customization-options"><p>Customization Options</p>
</a></li></ul></li><li><a href="#view-customization"><p>View Customization</p>
</a><ul><li><a href="#hooks"><p>Hooks</p>
</a></li> <li><a href="#template-replacements"><p>Template Replacements</p>
</a></li></ul></li><li><a href="#logic-customization"><p>Logic Customization</p>
</a><ul><li><a href="#accessing-product-data"><p>Accessing Product Data</p>
</a></li></ul></li><li><a href="#overriding-controller-action-responses"><p>Overriding Controller Action Responses</p>
</a><ul><li><a href="#respond_override-method"><p>respond_override method</p>
</a></li> <li><a href="#example-usage"><p>Example Usage</p>
</a></li> <li><a href="#caveats"><p>Caveats</p>
</a></li></ul></li><li><a href="#product-images"><p>Product Images</p>
</a><ul><li><a href="#image-resizing-option-syntax"><p>Image resizing option syntax</p>
</a></li></ul></li>
        </ol>
      </div>

    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <h3 id="types-of-customizations">1 Types of Customizations</h3>
<p>Spree supports two methods for managing and organizing your customizations, while they both support exactly the same options for customization they differ in terms of re-usability. So before you get started you need to decide what sort of customizations you are going to make:</p>
<h4 id="site-specific">1.1 Site Specific</h4>
<p>Site specfic customizations are the most common type of customization applied to Spree, it&#8217;s used by developers and designers to provide a unique design for each individual store. Site specific customizations can also be used to tweak Spree&#8217;s behaviour in small ways to match a particular business&#8217;s operating procedures, or provide a unique feature.</p>
<p>All site specific customizations are stored within the host application where Spree is installed (please see the Installation section of the <a href="getting_started.html">Getting Started with Spree</a> guide, for how to setup the host application).</p>
<h4 id="re-usable-extensions">1.2 Re-usable Extensions</h4>
<p>Extensions enable developers to enhance or add functionality to Spree, and are generally discrete pieces of functionality that are shared and intended to be installed in multiple Spree implementations.</p>
<p>Extensions are generally distributed as ruby gems and implemented as standard Rails 3 engines so they provide a natural way to bundle all the changes needed to implement larger features.</p>
<p>Visit the <a href="http://spreecommerce.com/extensions">Extension Registry</a> to get an idea of the type and volume of extensions available.</p>
<h4 id="customization-options">1.3 Customization Options</h4>
<p>Once you&#8217;ve decided how you&#8217;re going to manage your customizations, you then need to choose the correct option to achieve the desired changes:</p>
<ul>
	<li><b>View Customizations</b> allow you to change and/or extend the look and feel of a Spree store (and it&#8217;s administration system).</li>
	<li><b>Logic Customizations</b> enable you to change and/or extend the business logic of Spree to meet your specific business requirements.</li>
</ul>
<h3 id="view-customization">2 View Customization</h3>
<p>View customization allows you to extend or replace any view (erb) within a store, Spree supports two different view customization options:</p>
<h4 id="hooks">2.1 Hooks</h4>
<p>Hooks are a way of inserting your own content into pre-defined parts of Spreeâ€™s default templates, hooks are flexible to allow multiple extensions as well as the site specific changes to be applied cumulatively. Hooks provide a simple way to change an existing view without completley replacing it.</p>
<h5 id="available-hooks">2.1.1 Available hooks</h5>
<p>Hooks are pre-defined in most templates within Spree and are available to let you add content after product lists, within sidebars and other useful places. There is a full list of <a href="hooks.html">available hooks</a>.</p>
<h5 id="where-to-define-hooks">2.1.2 Where to define hooks</h5>
<p>Hook definitions can be located anywhere, but most sites and extensions use the following convention:</p>
<div class="info"><p><b>Site Specific</b> hooks are defined in lib/site_hooks.rb, and you need to require this file in lib/spree_site.rb.</p></div>

<div class="info"><p><b>Extensions</b> hooks are defined in lib/extension_name_hooks.rb, and are required within the lib/extension_name.rb (engine file).</p></div>
<h5 id="using-hooks">2.1.3 Using hooks</h5>
<p>Most hooks are defined with blocks so they span a region of the template, allowing content to be replaced or removed as well as added to.</p>
<p>Within the ***_hooks.rb file you can specify which content should be inserted into which hooks using the following 4 methods:</p>
<ul>
	<li>insert_before</li>
	<li>insert_after</li>
	<li>replace</li>
	<li>remove</li>
</ul>
<h5 id="inserting-and-replacing-content">2.1.4 Inserting and replacing content</h5>
<p>Supply a hook name followed by any arguments youâ€™d use with the standard Rails <em>render</em> method.</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">

insert_before :homepage_products, :text =&gt; &quot;&lt;h1&gt;Welcome!&lt;/h1&gt;&quot;

insert_after :homepage_products, 'shared/offers' 
   
replace :taxon_sidebar_navigation, 'shared/my_sidebar'
</pre></div><h5 id="using-a-block">2.1.5 Using a block</h5>
<p>The block should return an erb string to be evaluated. It has access to any methods or instance variables available in the view. Certain local variables are also available.</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">

  # adding a link below product details:
  insert_after :product_description do
    '&lt;p&gt;&lt;%= link_to(&quot;Back to products&quot;, products_path) %&gt;&lt;/p&gt;'
  end

  # adding a new tab to the admin navigation
  insert_after :admin_tabs do
    &quot;&lt;%= tab(:taxonomies) %&gt;&quot;
  end
</pre></div><h5 id="removing-a-hook-s-content">2.1.6 Removing a hookâ€™s content</h5>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">

  remove :homepage_products
</pre></div><h5 id="sample-hook-definition-file">2.1.7 Sample hook definition file:</h5>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">

  class SiteHooks &lt; Spree::ThemeSupport::HookListener
    replace :taxon_sidebar_navigation, 'shared/my_sidebar'

    insert_after :admin_tabs do
      &quot;&lt;%= tab(:taxonomies) %&gt;&quot;
    end
  end
</pre></div><h4 id="template-replacements">2.2 Template Replacements</h4>
<p>To override any of Spreeâ€™s default views, including those for the admin interface, simply create a file with the same filename in your app/views directory.</p>
<p>For example, to override the main layout, create the file YOUR_SITE_OR_EXTENSION/app/views/layouts/spree_application.html.erb</p>
<h3 id="logic-customization">3 Logic Customization</h3>
<p>All of Spree&#8217;s business logic (models, controllers, etc) can easily be extended / overridden to meet your exact requirements using standard Ruby idioms.</p>
<p>Standard practice for including such changes in your site or extension is to create a file within the relevant <strong>app/models</strong> or <strong>app/controllers</strong> directory with the original class name with <b>_decorator</b> appended.</p>
<div class="note"><p>To activate your decorators you need to include the follow code in your <strong>lib/spree_site.rb</strong> or <strong>lib/extension_name.rb</strong> file:</p></div>

<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">

  Dir.glob(File.join(File.dirname(__FILE__), &quot;../app/**/*_decorator*.rb&quot;)) do |c|
    Rails.configuration.cache_classes ? require(c) : load(c)
  end
</pre></div><p><b>Adding a custom method to the Product model:</b> app/models/product_decorator.rb</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">

  Product.class_eval do
    def some_method
      ...
    end
  end
</pre></div><p><b>Adding a custom action to the ProductsController:</b> app/controllers/products_controller_decorator.rb</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">

  ProductsController.class_eval do
    def some_action
      ...
    end
  end
</pre></div>
<div class="note"><p>The exact same format can be used to redefine an existing method.</p></div>
<h4 id="accessing-product-data">3.1 Accessing Product Data</h4>
<p>If you extend the Products controller with a new method, you may very well want to access product data in that method.  You can do so by using the :load_data before_filter.</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">

  ProductsController.class_eval do
    before_filter :load_data, :only =&gt; :some_action
	
    def some_action
      ...
    end
  end
</pre></div>
<div class="note"><p>:load_data will use params[:id] to lookup the product by its permalink.</p></div>
<h3 id="overriding-controller-action-responses">4 Overriding Controller Action Responses</h3>
<p>With the release of 0.60.0 Spree now supports a new way of overriding or changing the output of an existing controller&#8217;s action without needing to completly override the method (while also easily avoiding double render exceptions).</p>
<h4 id="respond_override-method">4.1 respond_override method</h4>
<p>The <strong>respond_override</strong> method is used to customize the repsonse from any action, and is built on top of Rails 3&#8217;s <strong>respond_with</strong> method (that all Spree controllers are now using). It accepts a hash of options using the following syntax:</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">

  respond_override :action_name =&gt; { :format =&gt; 
      { :result =&gt; lambda { ... response ... } } }
</pre></div><ul>
	<li><strong>:action_name</strong> &#8211; Can be any existing action within a controller (i.e. :update, :create, :new), provided that action is using respond_with to define it&#8217;s response.</li>
	<li><strong>:format</strong> &#8211; The format of the request, (i.e. :html, :json, :js, etc). All Spree controllers have a class level <strong>respond_to</strong> method call that defines which formats the controller&#8217;s actions will respond to.</li>
	<li><strong>:result</strong> &#8211; Two possible results are available on any given response, :success or :failure. :success being the default for most actions, however actions that change or create models will have a :failure response if validation fails for the model being updated.</li>
	<li><strong>lambda</strong> &#8211; The lambda passed contains the actual code to create the desired custom response (i.e. render or redirect_to). A lamdba must be passed to ensure the code is evaluated at the correct time.</li>
</ul>
<h4 id="example-usage">4.2 Example Usage</h4>
<p>If you wanted to render a custom partial for the index action of ProductsController, you could include the following in your <strong>app/models/products_controller_decorator.rb</strong> file.</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">

  ProductsController.class_eval do
    respond_override :index =&gt; { :html =&gt; { :success =&gt; lambda { render :partial =&gt; &quot;shared/some_file&quot; } } }
  end
</pre></div><p>Or if you wanted to redirect on the failure to create in Admin::ProductsController, you would use:</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">

  Admin::ProductsController.class_eval do
    respond_override :create =&gt; { :html =&gt; { :failure =&gt; lambda { redirect_to some_url } } }
  end
</pre></div><h4 id="caveats">4.3 Caveats</h4>
<ul>
	<li>If an action does not use <strong>respond_with</strong> to define it&#8217;s response the <strong>respond_override</strong> will not work.</li>
	<li>Some actions contain several <strong>repond_with</strong> calls so any <strong>respond_override</strong> defined on it will be executed for any of the <strong>respond_with</strong> instances, so it&#8217;s important to check the model state / logic within the lambda passed to prevent overriding all possible responses with the same override.</li>
</ul>
<h3 id="product-images">5 Product Images</h3>
<p>Spree uses Thoughtbot&#8217;s <a href="https://github.com/thoughtbot/paperclip">paperclip</a> gem to manage images for products. All the normal paperclip options are available on the Image class. If you want to modify the default spree product and thumbnail image sizes, simply create an image_decorator.rb file in your app model directory, and override the attachment sizes:</p>
<div class="code_container">
<pre class="brush: ruby; gutter: false; toolbar: false">

  Image.class_eval do
    attachment_definitions[:attachment][:styles] = {
      :mini =&gt; '48x48&gt;', # thumbs under image
      :small =&gt; '100x100&gt;', # images on category view
      :product =&gt; '240x240&gt;', # full product image
      :large =&gt; '600x600&gt;'  # light box image
    }
  end
</pre></div><p>You may also add additional image sizes for use in your templates (:micro for shopping cart view, for example).</p>
<h4 id="image-resizing-option-syntax">5.1 Image resizing option syntax</h4>
<p>Default behavior is to resize the image and maintain aspect ratio (i.e. the :product version of a 480Ã—400 image will be 240Ã—200). Some commonly used options are:</p>
<ul>
	<li>trailing #, image will be centrally cropped, ensuring the requested dimensions.</li>
	<li>trailing &gt;, image will only be modified if it is currently larger than the requested dimensions. (i.e. the :small thumb for a 100Ã—100 original image will be unchanged)</li>
</ul>

      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p>This work is licensed under a <a href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-Share Alike 3.0</a> License</a></p>
    </div>

  </div>

  <script type="text/javascript" src="javascripts/guides.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shCore.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushRuby.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushJScript.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushCss.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushXml.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushSql.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushPlain.js"></script>
  <script type="text/javascript">
    SyntaxHighlighter.all()
  </script>
</body>
</html>
